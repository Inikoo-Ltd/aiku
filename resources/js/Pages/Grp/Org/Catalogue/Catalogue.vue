<!--
  -  Author: Raul Perusquia <raul@inikoo.com>
  -  Created: Thu, 13 Oct 2022 15:35:22 Central European Summer Plane Malaga - East Midlands UK
  -  Copyright (c) 2022, Raul A Perusquia Flores
  -->

<script setup lang="ts">
import { Head } from "@inertiajs/vue3"
import { library } from "@fortawesome/fontawesome-svg-core"
import { faCubes, faFolderDownload, faSeedling } from "@fal"
import { faFireAlt } from "@fad"
import { faCheckCircle, faTimesCircle, faExclamationTriangle } from "@fas"

import PageHeading from "@/Components/Headings/PageHeading.vue"
import { capitalize } from "@/Composables/capitalize"
import { PageHeading as PageHeadingTS } from "@/types/PageHeading"
import { FontAwesomeIcon } from "@fortawesome/vue-fontawesome"
import { inject, ref } from "vue"
import { aikuLocaleStructure } from "@/Composables/useLocaleStructure"
import { trans } from "laravel-vue-i18n"
import Image from "@/Components/Image.vue"
import { layoutStructure } from "@/Composables/useLayoutStructure"
import { routeType } from "@/types/route"
import { Image as ImageProxy } from "@/types/Image"
import StatsBox from "@/Components/Stats/StatsBox.vue"

library.add(faCheckCircle, faTimesCircle, faCubes, faSeedling, faFireAlt, faExclamationTriangle, faFolderDownload)

const props = defineProps<{
    pageHead: PageHeadingTS
    tabs: {
        current: string
        navigation: {}
    },
    title: string
    stats: {
        id: number
        label: string
        value: number
        change: number
        changeType: string
        icon: string
        color: string
        backgroundColor?: string
        is_negative?: boolean
        route: {
            name: string
            parameters: {}
        }
        metaRight?: {
            count: number
            icon: {
                icon: string
                class: string
                tooltip: string
            }
            route: routeType
            tooltip: string
        }
        metas?: {
            count: number
            icon: {
                icon: string
                class: string
                tooltip: string
            }
            route: routeType
            tooltip: string
        }[]
    }[]
    top_selling: {
        product: {
            value: {
                id: number
                name: string
                code: string
                images: {
                    data: {
                        source: ImageProxy
                    }[]
                }
                sold_on_month: number
                stock: number
                price: number
            }
        }
        family: {
            value: {
                id: number
                name: string
            }
            icon: string
        }
        department: {
            value: {
                id: number
                name: string
                current_families: number
                current_products: number
            }
        }
    }
}>()


const locale = inject("locale", aikuLocaleStructure)
const layout = inject("layout", layoutStructure)

// const stats = [
//     { id: 1, label: 'Total Subscribers', stat: '71,897', change: '122', changeType: 'increase' },
//     { id: 2, label: 'Avg. Open Rate', stat: '58.16%', change: '5.4%', changeType: 'increase' },
//     { id: 3, label: 'Avg. Click Rate', stat: '24.57%', change: '3.2%', changeType: 'decrease' },
// ]


const boxLoaded = ref<{ [key: string]: boolean }>({})
const isLoadingMeta = ref<string | null>(null)

</script>


<template>

    <Head :title="capitalize(title)" />
    <PageHeading :data="pageHead" />

    <!-- Stats: box -->
    <div class="p-6">
        <dl class="grid grid-cols-1 gap-2 lg:gap-5 sm:grid-cols-2 lg:grid-cols-4">
            <StatsBox
                v-for="(stat, idxStat) in stats"
                :stat="stat"
            >
            </StatsBox>
        </dl>
    </div>

    <!-- Section: Top of the Month -->
    <div v-if="top_selling?.product?.value?.all || top_selling?.department?.value?.all || top_selling?.family?.value?.all" class="p-6">
        <div class="text-xl font-semibold py-1 border-b border-gray-200">{{ trans("Top of the month (Top_selling)") }}</div>
        <dl class="isolate mt-4 grid grid-cols-1 gap-5 sm:grid-cols-2 sm:grid-rows-2 h-72">
            <!-- Top_selling: Product -->
            <div v-if="top_selling.product.value" class="row-span-2 example-2 rounded-md">
                <div class="inner group bg-gray-100 h-full rounded-md px-8 py-8 flex gap-x-4"
                     :style="{
                        background: `color-mix(in srgb, ${layout?.app?.theme[0]} 10%, white)`
                    }"
                >
                    <div class="aspect-square h-1/2 lg:h-full w-fit flex-shrink-0 rounded-md overflow-hidden">
                        <Image :src="top_selling.product.value?.images?.data?.[0]?.source" />
                    </div>

                    <div class="flex flex-col justify-between gap-y-1">
                        <div>
                            <div class="text-indigo-600 text-sm animate-pulse">{{ trans("Product of the month") }}</div>
                            <h3 class="text-xl font-semibold">
                                {{ top_selling.product.value?.name }}
                            </h3>
                            <div class="text-gray-400 text-sm">{{ top_selling.product.value?.code || "-" }}</div>
                        </div>
                        <div>
                            <p aria-hidden="true" class="text-gray-500">{{ trans("Sold this month") }}: {{ top_selling.product.value?.sold_on_month || "-" }}</p>
                            <p aria-hidden="true" class="text-gray-500">{{ trans("Stock") }}: {{ top_selling.product.value?.stock || "-" }}</p>
                            <p aria-hidden="true" class="text-gray-500">{{ trans("Price") }}: {{ top_selling.product.value?.price || "-" }}</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Top_selling: Department -->
            <div v-if="top_selling.department.value" class="bg-gray-50 border-gray-200 border rounded-md flex items-center p-6">
                <div class="flex gap-x-2 items-center">
                    <div class="p-3 rounded">
                        <FontAwesomeIcon icon="fal fa-folder-tree" class="text-indigo-500 text-xl" v-tooltip="trans('Department')" fixed-width aria-hidden="true" />
                    </div>
                    <div class="">
                        <div class="text-xl font-medium">{{ top_selling.department.value.name }}</div>
                        <div class="flex gap-x-10">
                            <div class="text-gray-500">
                                <FontAwesomeIcon icon="fal fa-folder" class="text-gray-400" fixed-width aria-hidden="true" />
                                {{ top_selling.department.value.current_families }}
                            </div>
                            <div class="text-gray-500">
                                <FontAwesomeIcon icon="fal fa-cube" class="text-gray-400" fixed-width aria-hidden="true" />
                                {{ top_selling.department.value.current_products }}
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <!-- Top_selling: Family -->
            <div v-if="top_selling.family.value" class="bg-gray-50 border-gray-200 border rounded-md flex items-center p-6">
                <div class="flex gap-x-2 items-center">
                    <div class="p-3 rounded">
                        <FontAwesomeIcon :icon="top_selling.family.icon" class="text-indigo-500 text-xl" v-tooltip="trans('Family')" fixed-width aria-hidden="true" />
                    </div>

                    <div class="">
                        <div class="text-xl font-medium">{{ top_selling.family.value.name }}</div>
                    </div>
                </div>
            </div>

        </dl>
    </div>


</template>

<style lang="scss">
.example-2 {
    position: relative;
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 1px;
}

.example-2 .inner {
    position: relative;
    z-index: 1;
    width: 100%;
    margin: 0;
}

.example-2::before {
    content: "";
    display: block;
    background: linear-gradient(
            90deg,
            rgba(255, 255, 255, 0) 0%,
            v-bind('`color-mix(in srgb, ${layout?.app?.theme[0]} 100%, transparent)`') 50%,
            rgba(255, 255, 255, 0) 100%
    );
    height: 150%;
    width: 300px;
    transform: translate(0);
    position: absolute;
    animation: rotate 3s linear forwards infinite;
    z-index: 0;
    top: 50%;
    transform-origin: top center;
}

@keyframes rotate {
    from {
        transform: rotate(0);
    }

    to {
        transform: rotate(360deg);
    }
}

</style>