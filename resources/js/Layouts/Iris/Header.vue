<script setup lang="ts">
import { getIrisComponent } from "@/Composables/getIrisComponents";
import { routeType } from "@/types/route";
import { inject, provide, computed } from "vue";
import { notify } from "@kyvg/vue3-notification";
import { trans } from "laravel-vue-i18n";
import axios from "axios";
import MobileHeader from "@/Components/CMS/Website/Headers/MobileHeader.vue";
import { getStyles } from "@/Composables/styles";

const props = defineProps<{
  data: {
    key: string,
    data: object,
    blueprint: object
    loginRoute?: routeType
  }
  menu: {
    key: string,
    data: object,
    blueprint: object
  }
  colorThemed: object
  screenType?: "mobile" | "tablet" | "desktop"
}>();


const layout = inject("layout", {});
const isLoggedIn = computed(() => {
  return layout.iris?.is_logged_in;
})
provide("isPreviewLoggedIn", isLoggedIn);

const onLogoutAuth = async () => {
  try {
    if (route().has("iris.logout")) {
      await axios.post(route("iris.logout"));
      window.location.reload();
    } else {
      await axios.post(route("retina.logout"));
      window.location.reload();
    }
  } catch (e) {
    console.error("error onLogoutAuth", e);
    notify({
      title: trans("Something went wrong"),
      text: trans("Failed to logout"),
      type: "error"
    });
  }
};


provide("onLogout", onLogoutAuth);

</script>

<template>
  <!-- Section: Topbar (login, logout) -->
  <component v-if="data?.topBar?.data.fieldValue" :is="getIrisComponent(data?.topBar.code)"
             :fieldValue="data.topBar.data.fieldValue" v-model="data.topBar.data.fieldValue" />

  <!-- Section: Header (logo, search, Title) -->
  <component v-if="data?.header" :is="getIrisComponent(data?.header?.code)" :fieldValue="data.header.data.fieldValue"
             class="hidden md:block" />

  <!-- Section: Menu desktop -->
  <component v-if="menu?.code" :is="getIrisComponent(menu?.code)" :fieldValue="menu?.data?.fieldValue"
             :colorThemed="colorThemed" class="hidden md:block" />

  <!-- Section: Mobile Header -->
  <div :style="getStyles(data.header.data.fieldValue.container.properties, screenType)">
      <MobileHeader :header-data="data.header.data.fieldValue" :menu-data="menu?.data?.fieldValue" :productCategories="menu.product_categories" :screenType="screenType" />
  </div>

</template>